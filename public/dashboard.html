<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard — TextKit API</title>
  <link rel="stylesheet" href="/css/style.css">
  <link rel="icon" type="image/svg+xml" href="/logo.svg">
</head>
<body>
  <a href="#main-content" class="skip-link">Skip to main content</a>
  <nav class="nav">
    <div class="nav-inner">
      <a href="/" class="nav-logo">Text<span>Kit</span></a>
      <ul class="nav-links">
        <li><a href="/docs">Docs</a></li>
        <li><a href="/studio.html">Studio</a></li>
        <li><a href="#" id="logoutBtn">Logout</a></li>
      </ul>
    </div>
  </nav>

  <main id="main-content" class="dashboard">
    <h1>Dashboard</h1>
    <p class="dashboard-subtitle" id="welcomeText">Welcome back</p>

    <!-- Stats Row -->
    <div class="dashboard-grid">
      <div class="stat-card">
        <div class="label">Current Plan</div>
        <div class="value" id="currentTier">—</div>
      </div>
      <div class="stat-card">
        <div class="label">Requests (30 days)</div>
        <div class="value" id="totalRequests">0</div>
      </div>
      <div class="stat-card">
        <div class="label">API Keys</div>
        <div class="value" id="keyCount">0</div>
      </div>
    </div>

    <!-- Subscription -->
    <div class="section-card">
      <h2>
        Subscription
        <span>
          <button class="btn btn-secondary btn-sm" id="manageBillingBtn" style="display:none">Manage Billing</button>
          <button class="btn btn-primary btn-sm" id="subscribeBtnTop" style="display:none">Choose Plan</button>
        </span>
      </h2>
      <div id="subscriptionInfo">
        <p style="color:var(--text-secondary)">Loading...</p>
      </div>

      <!-- Pricing selection (shown when no subscription) -->
      <div id="pricingSelect" style="display:none">
        <div class="pricing-grid" style="margin-top:16px">
          <div class="pricing-card">
            <h3>Basic</h3>
            <div class="pricing-price">$9<span>/mo</span></div>
            <ul class="pricing-features">
              <li>100 requests/day</li>
              <li>10 requests/minute</li>
            </ul>
            <button class="btn btn-secondary" style="width:100%" onclick="subscribe('BASIC')">Select</button>
          </div>
          <div class="pricing-card featured">
            <h3>Pro</h3>
            <div class="pricing-price">$29<span>/mo</span></div>
            <ul class="pricing-features">
              <li>500 requests/day</li>
              <li>30 requests/minute</li>
            </ul>
            <button class="btn btn-primary" style="width:100%" onclick="subscribe('PRO')">Select</button>
          </div>
          <div class="pricing-card">
            <h3>Ultra</h3>
            <div class="pricing-price">$79<span>/mo</span></div>
            <ul class="pricing-features">
              <li>2,000 requests/day</li>
              <li>60 requests/minute</li>
            </ul>
            <button class="btn btn-secondary" style="width:100%" onclick="subscribe('ULTRA')">Select</button>
          </div>
          <div class="pricing-card">
            <h3>Mega</h3>
            <div class="pricing-price">$199<span>/mo</span></div>
            <ul class="pricing-features">
              <li>Unlimited requests</li>
              <li>120 requests/minute</li>
            </ul>
            <button class="btn btn-secondary" style="width:100%" onclick="subscribe('MEGA')">Select</button>
          </div>
        </div>
      </div>
    </div>

    <!-- API Keys -->
    <div class="section-card">
      <h2>
        API Keys
        <button class="btn btn-primary btn-sm" id="createKeyBtn">Create Key</button>
      </h2>
      <div class="table-wrap">
        <table>
          <caption class="sr-only">Your API keys</caption>
          <thead>
            <tr>
              <th scope="col">Key</th>
              <th scope="col">Name</th>
              <th scope="col">Status</th>
              <th scope="col">Created</th>
              <th scope="col">Last Used</th>
              <th scope="col"></th>
            </tr>
          </thead>
          <tbody id="keysTableBody">
            <tr><td colspan="6" style="color:var(--text-secondary)">Loading...</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Usage -->
    <div class="section-card">
      <h2>Usage (Last 30 Days)</h2>
      <div class="table-wrap">
        <table>
          <caption class="sr-only">Usage statistics for last 30 days</caption>
          <thead>
            <tr>
              <th scope="col">Endpoint</th>
              <th scope="col">Requests</th>
              <th scope="col">Tokens Used</th>
            </tr>
          </thead>
          <tbody id="usageTableBody">
            <tr><td colspan="3" style="color:var(--text-secondary)">Loading...</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Account -->
    <div class="section-card">
      <h2>Account</h2>
      <p style="color:var(--text-secondary);margin-bottom:16px">Manage your account data and privacy settings.</p>
      <div style="display:flex;gap:12px;flex-wrap:wrap">
        <button class="btn btn-secondary" id="exportDataBtn">Export My Data</button>
        <button class="btn btn-danger" id="deleteAccountBtn">Delete My Account</button>
      </div>
    </div>
  </main>

  <footer class="footer" style="margin-top:40px">
    <div class="container">
      <p><a href="/terms.html">Terms of Service</a> &middot; <a href="/privacy.html">Privacy Policy</a></p>
    </div>
  </footer>

  <!-- New Key Modal -->
  <div class="modal-overlay" id="newKeyModal" role="dialog" aria-modal="true" aria-labelledby="newKeyModalTitle">
    <div class="modal">
      <h3 id="newKeyModalTitle">New API Key Created</h3>
      <p class="key-warning">Copy this key now. You won't be able to see it again.</p>
      <div class="key-display" id="newKeyDisplay"></div>
      <div style="display:flex;gap:8px">
        <button class="btn btn-primary" onclick="copyKey()">Copy</button>
        <button class="btn btn-secondary" onclick="closeNewKeyModal()">Done</button>
      </div>
    </div>
  </div>

  <!-- Create Key Modal -->
  <div class="modal-overlay" id="createKeyModal" role="dialog" aria-modal="true" aria-labelledby="createKeyModalTitle">
    <div class="modal">
      <h3 id="createKeyModalTitle">Create API Key</h3>
      <form id="createKeyForm">
        <div class="form-group">
          <label for="keyName">Key Name</label>
          <input type="text" id="keyName" placeholder="e.g. Production, Testing" value="Default">
        </div>
        <div style="display:flex;gap:8px">
          <button type="submit" class="btn btn-primary">Create</button>
          <button type="button" class="btn btn-secondary" onclick="closeCreateKeyModal()">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Delete Account Modal -->
  <div class="modal-overlay" id="deleteAccountModal" role="dialog" aria-modal="true" aria-labelledby="deleteAccountModalTitle">
    <div class="modal">
      <h3 id="deleteAccountModalTitle">Delete Your Account</h3>
      <p style="color:var(--text-secondary);margin-bottom:16px">This action is permanent and cannot be undone. All your data, API keys, and subscriptions will be deleted.</p>
      <form id="deleteAccountForm">
        <div class="form-group">
          <label for="deletePassword">Enter your password to confirm</label>
          <input type="password" id="deletePassword" required aria-required="true" placeholder="Your password">
        </div>
        <p id="deleteError" style="color:#ef4444;display:none;margin-bottom:12px" role="alert" aria-live="assertive"></p>
        <div style="display:flex;gap:8px">
          <button type="submit" class="btn btn-danger">Permanently Delete</button>
          <button type="button" class="btn btn-secondary" onclick="closeDeleteAccountModal()">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <script src="/js/dashboard.js"></script>
</body>
</html>
